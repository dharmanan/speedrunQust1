# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Upload and Mint NFTs
on:
  workflow_dispatch:
  # push:
  #   paths:
  #     - 'images/**'
  #     - 'scripts/upload-and-mint.cjs'
  #     - '.github/workflows/upload-and-mint.yml'
  #     - 'package.json'
  #     - 'yarn.lock'

jobs:
  upload_and_mint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
      - name: Install dependencies
        run: yarn install --frozen-lockfile || yarn install
      - name: Upload images and mint NFTs
        env:
          PINATA_API_KEY: ${{ secrets.PINATA_API_KEY }}
          PINATA_API_SECRET: ${{ secrets.PINATA_API_SECRET }}
          MNEMONIC: ${{ secrets.MNEMONIC }}
          ALCHEMY_API_KEY: ${{ secrets.ALCHEMY_API_KEY }}
          CONTRACT_ADDRESS: ${{ secrets.CONTRACT_ADDRESS }}
        run: |
          node scripts/upload-and-mint.cjs ./images ./metadataList.json ${{ secrets.CONTRACT_ADDRESS }}
